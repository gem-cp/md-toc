<script>
{% raw %}
document.addEventListener("DOMContentLoaded", function () {
  const siteTitleContainer = document.querySelector(".site-header .site-title");
  const siteLogo = document.querySelector(".site-logo");

  if (siteTitleContainer && siteLogo) {
    const siteTitleText = siteLogo.getAttribute("aria-label");
    if (siteTitleText) {
      const titleSpan = document.createElement("span");
      titleSpan.className = "site-title-text";
      titleSpan.textContent = siteTitleText;
      siteTitleContainer.appendChild(titleSpan);
      siteTitleContainer.classList.add("has-logo-and-text");
    }
  }

  const inPageTocList = document.querySelector("#markdown-toc");
  const sidebar = document.querySelector(".side-bar");

  if (inPageTocList && sidebar) {
    const detailsParent = inPageTocList.closest('details');
    inPageTocList.classList.add("toc-in-sidebar");

    const tocContainerInSidebar = document.createElement("nav");
    tocContainerInSidebar.classList.add("nav-list", "nav-list--toc");

    const tocTitle = document.createElement("span");
    tocTitle.textContent = "On this page";
    tocTitle.classList.add("toc-sidebar-title");
    tocContainerInSidebar.appendChild(tocTitle);
    
    tocContainerInSidebar.appendChild(inPageTocList);

    const activeListItem = sidebar.querySelector(".nav-list-item.active");
    if (activeListItem) {
      activeListItem.appendChild(tocContainerInSidebar);
    } else {
      sidebar.appendChild(tocContainerInSidebar);
      if (console && console.warn) {
        console.warn("Sidebar ToC: No active .nav-list-item found for #markdown-toc. Appending ToC to end of sidebar.");
      }
    }

    if (detailsParent) {
      detailsParent.style.display = 'none';
    }
    document.body.classList.add("js-toc-sidebar");

  } else if (sidebar) {
    const themeToc = document.querySelector(".toc"); 
    if (themeToc) {
      if (console && console.log) {
        console.log("Sidebar ToC: #markdown-toc not found, attempting to use theme's .toc element.");
      }
      const clonedThemeToc = themeToc.cloneNode(true);
      clonedThemeToc.classList.add("toc-in-sidebar");

      const tocContainerInSidebar = document.createElement("nav");
      tocContainerInSidebar.classList.add("nav-list", "nav-list--toc");
      
      const tocTitle = document.createElement("span");
      tocTitle.textContent = "On this page";
      tocTitle.classList.add("toc-sidebar-title");
      tocContainerInSidebar.appendChild(tocTitle);

      tocContainerInSidebar.appendChild(clonedThemeToc);

      const activeListItem = sidebar.querySelector(".nav-list-item.active");
      if (activeListItem) {
        activeListItem.appendChild(tocContainerInSidebar);
      } else {
        sidebar.appendChild(tocContainerInSidebar);
        if (console && console.warn) {
          console.warn("Sidebar ToC: No active .nav-list-item found for theme .toc. Appending ToC to end of sidebar.");
        }
      }
      document.body.classList.add("js-toc-sidebar");
    }
  }
});
{% endraw %}
</script>

<style>
/* --- Styling for Site Title next to Logo --- */
.site-header a.site-title.has-logo-and-text {
  display: flex;
  align-items: center;
}

.site-title-text {
  margin-left: 0.75rem;
  /* >> MODIFIED: Smaller font, slightly bold, and forced to a single line */
  font-size: 1.1rem;
  font-weight: 600;
  white-space: nowrap; /* Prevents the title from wrapping to a new line */
  overflow: hidden; /* Hides any part of the title that doesn't fit */
  text-overflow: ellipsis; /* Adds "..." if the title is too long for the space */
}

/* --- Base ToC Rules --- */
body.js-toc-sidebar .main-content-wrap .toc {
  display: none;
}

.nav-list--toc {
  margin-top: 0;
  padding-left: 0;
  font-size: 0.9rem;
}

.toc-sidebar-title {
  display: block;
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--jtc-text-color-muted, #6c757d);
  /* >> MODIFIED: Adjusted padding to align with the new tree structure */
  padding-left: 0.8rem;
  margin-bottom: 0.75rem;
  border-top: 1px solid var(--jtc-border-color, #dee2e6); 
  padding-top: 1rem;
  margin-top: 1rem;
}

/* >> MODIFIED: Resetting initial padding. Indentation will now be handled by nested ULs only. */
.toc-in-sidebar {
  all: unset;
  display: block;
  list-style-type: none; /* Explicitly set list style to none here */
}

/* >> MODIFIED: The base indentation for all lists is now handled here. */
.toc-in-sidebar ul {
  list-style-type: none;
  margin: 0;
  padding-left: 1.2rem; /* This creates the space for our new tree lines */
}

.toc-in-sidebar li {
  margin: 0;
  position: relative; /* Required for positioning the new lines */
}

.toc-in-sidebar a {
  text-decoration: none;
  display: block; 
  padding: 0.2rem 0.5rem; /* Slightly more vertical padding */
  color: var(--jtc-nav-link-color, var(--jtc-text-color));
}
.toc-in-sidebar a:hover {
  text-decoration: underline;
  color: var(--jtc-link-hover-color, #0076df);
}

/* --- >> NEW: Beautiful Tree Lines --- */
/* Remove old line styles */
.toc-in-sidebar li > ul::before, 
.toc-in-sidebar li > ul > li::before {
  display: none;
}

/* Draw the vertical line using the ::after pseudo-element */
.toc-in-sidebar ul li::after {
  content: '';
  position: absolute;
  top: 0;
  left: -0.7rem; /* Positioned within the UL's padding */
  width: 1px;
  height: 100%;
  background: var(--jtc-border-color, #e1e4e8); /* A slightly softer color */
}

/* Draw the horizontal connector using the ::before pseudo-element */
.toc-in-sidebar ul li::before {
  content: '';
  position: absolute;
  top: 0.8rem; /* Aligns with the middle of the text line */
  left: -0.7rem; /* Aligns with the vertical line */
  width: 0.7rem; /* The length of the horizontal line */
  height: 1px;
  background: var(--jtc-border-color, #e1e4e8);
}

/* Stop the vertical line for the LAST item in a list */
.toc-in-sidebar ul li:last-child::after {
  height: 0.8rem; /* Stops the line at the horizontal connector */
}

/* Ensure top-level items (direct children of .toc-in-sidebar) don't get lines */
.toc-in-sidebar > li::before,
.toc-in-sidebar > li::after {
    display: none;
}

/* Hierarchical styling for links based on nesting depth (Unchanged) */
.toc-in-sidebar > li > a { font-size: 1em; }
.toc-in-sidebar > li > ul > li > a { font-size: 0.95em; }
.toc-in-sidebar > li > ul > li > ul > li > a { font-size: 0.9em; }
.toc-in-sidebar > li > ul > li > ul > li > ul > li > a { font-size: 0.85em; }
.toc-in-sidebar > li > ul > li > ul > li > ul > li > ul > li > a { font-size: 0.80em; }
.toc-in-sidebar > li > ul > li > ul > li > ul > li > ul > li > ul > li > a { font-size: 0.75em; }
</style>