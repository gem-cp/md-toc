<script>
{% raw %}
document.addEventListener("DOMContentLoaded", function () {
  const inPageTocList = document.querySelector("#markdown-toc");
  const sidebar = document.querySelector(".side-bar");

  if (inPageTocList && sidebar) {
    const detailsParent = inPageTocList.closest('details');

    inPageTocList.classList.add("toc-in-sidebar");

    const tocContainerInSidebar = document.createElement("nav");
    tocContainerInSidebar.classList.add("nav-list", "nav-list--toc");
    tocContainerInSidebar.appendChild(inPageTocList);
    const activeListItem = sidebar.querySelector(".nav-list-item.active");
    if (activeListItem) {
      activeListItem.appendChild(tocContainerInSidebar);
    } else {
      sidebar.appendChild(tocContainerInSidebar);
      if (console && console.warn) {
        console.warn("Sidebar ToC: No active .nav-list-item found for #markdown-toc. Appending ToC to end of sidebar.");
      }
    }

    if (detailsParent) {
      detailsParent.style.display = 'none';
    }
    document.body.classList.add("js-toc-sidebar");

  } else if (sidebar) {
    const themeToc = document.querySelector(".toc"); 
    if (themeToc) {
      if (console && console.log) {
        console.log("Sidebar ToC: #markdown-toc not found, attempting to use theme's .toc element.");
      }
      const clonedThemeToc = themeToc.cloneNode(true);
      clonedThemeToc.classList.add("toc-in-sidebar");

      const tocContainerInSidebar = document.createElement("nav");
      tocContainerInSidebar.classList.add("nav-list", "nav-list--toc");
      tocContainerInSidebar.appendChild(clonedThemeToc);

      const activeListItem = sidebar.querySelector(".nav-list-item.active");
      if (activeListItem) {
        activeListItem.appendChild(tocContainerInSidebar);
      } else {
        sidebar.appendChild(tocContainerInSidebar);
        if (console && console.warn) {
          console.warn("Sidebar ToC: No active .nav-list-item found for theme .toc. Appending ToC to end of sidebar.");
        }
      }
      document.body.classList.add("js-toc-sidebar");
    }
  }
});
{% endraw %}
</script>

<style>
/* Hide original .toc if sidebar ToC is successfully injected and body has class */
body.js-toc-sidebar .main-content-wrap .toc {
  display: none;
}

/* Styling for the <nav> container of the ToC in the sidebar */
.nav-list--toc {
  margin-top: 1rem; 
  padding-left: 0; /* Resetting this, primary indent will be on .toc-in-sidebar */
  font-size: 0.9rem; /* Base font size for ToC items */
}

/* Styling for the "Inhalt" title (H2) - Element removed from JS */
/*
.nav-list--toc .nav__title {
  font-size: 0.9em; 
  font-weight: bold;
  margin-bottom: 0.5rem;
  padding-left: 0.5rem; 
}
*/

/* Styling for the UL element that is the ToC itself (either #markdown-toc or cloned .toc) */
.toc-in-sidebar {
  all: unset; /* Remove browser default list styles */
  display: block; /* Ensure it behaves as a block element */
  padding-left: 1.5rem; /* Initial indent for the ToC list itself */
}

/* Styling for all UL elements within the .toc-in-sidebar */
.toc-in-sidebar ul {
  list-style-type: none;
  margin: 0;
  padding-left: 0; /* Base level ULs (like .toc-in-sidebar itself) have no indent */
}

/* Indentation for nested ULs (representing deeper heading levels) */
.toc-in-sidebar ul ul { 
  padding-left: 1.25rem; /* Further increased indent step for sub-levels */
  margin-top: 0.1rem; /* Small spacing for nested lists */
  margin-bottom: 0.1rem;
}

/* Styling for LI elements within the .toc-in-sidebar */
.toc-in-sidebar li {
  margin-bottom: 0.1rem; 
}

/* Styling for A (link) elements within the .toc-in-sidebar */
.toc-in-sidebar a {
  text-decoration: none;
  display: block; 
  padding: 0.125rem 0.5rem; /* Padding for clickable area */
  color: var(--jtc-nav-link-color, var(--jtc-text-color)); /* Use theme variables with fallback */
}
.toc-in-sidebar a:hover {
  text-decoration: underline;
  color: var(--jtc-link-hover-color, #0076df); /* Use theme variable with fallback */
}

/* Connection lines for tree-view effect */
.toc-in-sidebar ul,
.toc-in-sidebar li {
  position: relative; /* Required for positioning pseudo-elements */
}

/* Vertical line for all ULs that are children of an LI (i.e., all nested lists) */
.toc-in-sidebar li > ul::before {
  content: "";
  position: absolute;
  left: -0.6em; /* Position left of the padding of the li > a */
               /* This value may need adjustment based on actual padding/font of parent LI's A tag */
  top: -0.4em;   /* Start slightly above the first item */
  bottom: 0.2em; /* End slightly below the last item */
  width: 1px;
  background-color: #ddd; /* Line color */
}

/* Horizontal connector for LI items that have a preceding vertical line from their parent UL */
.toc-in-sidebar li > ul > li::before,
.toc-in-sidebar > li > ul > li::before { /* Covers LIs in the first nested UL */
    content: "";
    position: absolute;
    left: -0.6em; /* Align with the UL's vertical line */
    top: 0.7em;    /* Adjust for vertical centering against text (approx half line-height) */
    width: 0.6em;  /* Length of the horizontal line, adjust as needed */
    height: 1px;
    background-color: #ddd; /* Line color */
}

/* Remove horizontal connector for top-level LIs if .toc-in-sidebar is the very first UL */
/* (This selector might not be needed if the above is specific enough) */
/* .toc-in-sidebar > li::before { display: none; } */

/* Remove vertical line from the main .toc-in-sidebar UL itself if it were to get one */
.toc-in-sidebar::before, .toc-in-sidebar::after { /* Ensure the root UL doesn't get lines */
    display:none !important;
}


/* Hierarchical styling for links based on nesting depth */
/* .toc-in-sidebar is the main UL itself */

/* Level 1 links (direct LI children of .toc-in-sidebar) */
.toc-in-sidebar > li > a {
  /* font-weight: bold; */ /* Removed per user request */
  font-size: 1em; /* Relative to .nav-list--toc's font-size */
}

/* Level 2 links (links within the first level of nested ULs) */
.toc-in-sidebar > li > ul > li > a {
  font-size: 0.95em; /* Slightly smaller */
}

/* Level 3 links */
.toc-in-sidebar > li > ul > li > ul > li > a {
  font-size: 0.9em;
}

/* Level 4 links */
.toc-in-sidebar > li > ul > li > ul > li > ul > li > a {
  font-size: 0.85em;
}

/* Level 5 links */
.toc-in-sidebar > li > ul > li > ul > li > ul > li > ul > li > a {
  font-size: 0.80em;
}

/* Level 6 links */
.toc-in-sidebar > li > ul > li > ul > li > ul > li > ul > li > ul > li > a {
  font-size: 0.75em;
}
</style>
